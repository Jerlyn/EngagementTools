<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand X Eligibility Assessment</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Removed min-h-screen flex items-center justify-center from body */
            background: linear-gradient(to bottom right, #eff6ff, #e0e7ff); /* bg-gradient-to-br from-blue-50 to-indigo-100 */
        }
    </style>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas and jspdf CDNs for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="p-4">
    <div id="root" class="bg-white p-8 rounded-xl shadow-2xl max-w-3xl w-full mx-auto my-8 border-t-4 border-indigo-500"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Define the questions and their logic
        const questions = [
          {
            id: 1,
            text: "What is your age group?",
            category: "Age Group",
            options: [
              { text: "Under 18 years old", answerText: "Under 18 years old", result: "age_contraindication" },
              { text: "18-65 years old", answerText: "18-65 years old", nextQuestion: 2 },
              { text: "Over 65 years old", answerText: "Over 65 years old", nextQuestion: 2 },
            ],
          },
          {
            id: 2,
            text: "Have you been diagnosed with Condition Y?",
            category: "Diagnosis Status",
            options: [
              { text: "Yes, confirmed diagnosis", answerText: "Confirmed diagnosis", nextQuestion: 3 },
              { text: "Suspected but not confirmed", answerText: "Suspected but not confirmed", result: "diagnosis_required" },
              { text: "No, not diagnosed with Condition Y", answerText: "Not diagnosed with Condition Y", result: "not_indicated" },
            ],
          },
          {
            id: 3,
            text: "Have you previously tried any other treatments for Condition Y?",
            category: "Previous Treatments",
            options: [
              { text: "Yes", answerText: "Tried other treatments", nextQuestion: 4 },
              { text: "No", answerText: "Not tried any treatments", result: "not_tried_any_treatment" },
            ],
          },
          {
            id: 4,
            text: "If you tried other treatments, did they adequately control your symptoms?",
            category: "Treatment Response",
            options: [
              { text: "Yes, they were effective", answerText: "Effective", result: "other_treatment_working" },
              { text: "No, they were ineffective", answerText: "Ineffective", nextQuestion: 5 },
            ],
          },
          {
            id: 5,
            text: "What is your current symptom severity?",
            category: "Current Symptom Severity",
            options: [
              { text: "Mild - no impact on daily activities", answerText: "Mild", nextQuestion: 6 },
              { text: "Moderate - some impact on daily activities", answerText: "Moderate", nextQuestion: 6 },
              { text: "Severe - significant impact on daily activities", answerText: "Severe", nextQuestion: 6 },
            ],
          },
          {
            id: 6,
            text: "Do you have any of the following conditions: severe liver disease, severe kidney disease?",
            category: "Other Medical Conditions",
            options: [
              { text: "Yes", answerText: "Liver or kidney condition", result: "liver_kidney_condition" },
              { text: "No", answerText: "No severe liver/kidney condition", nextQuestion: 7 },
            ],
          },
          {
            id: 7,
            text: "Are you currently taking any of the following medications: Medication B, Medication C?",
            category: "Current Medications",
            options: [
              { text: "Yes", answerText: "Taking Medication B/C", result: "medication_interaction" },
              { text: "No", answerText: "Not taking Medication B/C", result: "potentially_eligible" },
            ],
          },
        ];

        // Define the possible results/next steps
        const results = {
          age_contraindication: {
            title: "Brand X is typically not prescribed for your age group.",
            message: "Brand X is generally not prescribed for patients under 18. Please consult with a pediatric specialist for appropriate treatment options.",
            action: "Consult a pediatric specialist.",
            recommendationHTML: "Brand X is typically not prescribed for patients under 18. Consult with a pediatric specialist."
          },
          not_indicated: {
            title: "Brand X is not indicated for your condition.",
            message: "Based on your answers, Brand X is typically not used for your diagnosed condition. Please consult your doctor for alternative treatment options that may be more suitable for you.",
            action: "Consult your doctor.",
            recommendationHTML: "Brand X is not indicated for your condition. Consult your doctor for alternative options."
          },
          diagnosis_required: {
            title: "A confirmed diagnosis is required.",
            message: "A confirmed diagnosis of Condition Y is required before considering Brand X. Please schedule an appointment for proper evaluation.",
            action: "Schedule an appointment for proper evaluation.",
            recommendationHTML: "A confirmed diagnosis is required before considering Brand X. Schedule an appointment for proper evaluation."
          },
          not_tried_any_treatment: {
            title: "Consider initial treatments first.",
            message: "Brand X is generally considered after a patient has tried other initial treatments for Condition Y. We recommend discussing first-line treatment options with your doctor.",
            action: "Discuss initial treatments with your doctor.",
            recommendationHTML: "Brand X is generally considered after initial treatments. Discuss first-line options with your doctor."
          },
          other_treatment_working: {
            title: "Your current treatment seems to be working well!",
            message: "It appears that your current treatments are effectively managing your symptoms. Continue to follow your doctor's advice regarding your current treatment plan.",
            action: "Continue with your current treatment plan.",
            recommendationHTML: "Current treatment seems effective. Continue with your current treatment plan."
          },
          medication_interaction: {
            title: "Potential Medication Interactions.",
            message: "Based on your current medications, there might be potential interactions with Brand X. It's crucial to discuss all your current medications with your doctor before considering Brand X.",
            action: "Discuss all your medications with your doctor.",
            recommendationHTML: "Potential medication interactions. Discuss all current medications with your doctor."
          },
          liver_kidney_condition: {
            title: "Liver or kidney conditions may affect Brand X eligibility.",
            message: "Liver or kidney conditions may affect Brand X eligibility. Additional monitoring or alternative treatments may be required. Please discuss this with your doctor.",
            action: "Discuss liver/kidney conditions with your doctor.",
            recommendationHTML: "Liver or kidney conditions may affect Brand X eligibility. Additional monitoring may be required."
          },
          potentially_eligible: {
            title: "You may be eligible for Brand X!",
            message: "Based on your responses, you *may* be a candidate for Brand X. This assessment is for informational purposes only and does not constitute medical advice. It's important to discuss these findings with your doctor to confirm your eligibility and determine if Brand X is the right treatment option for you.",
            action: "Schedule an appointment with your doctor to discuss Brand X.",
            recommendationHTML: "Based on responses, you may be eligible for Brand X. Discuss with your doctor for confirmation."
          },
        };

        const App = () => {
          const [currentQuestionId, setCurrentQuestionId] = useState(1);
          const [assessmentResult, setAssessmentResult] = useState(null);
          const [showDisclaimer, setShowDisclaimer] = useState(true);
          const [userAnswers, setUserAnswers] = useState({}); // Stores {questionId: {questionText, answerText, category}}
          const [isGeneratingPdf, setIsGeneratingPdf] = useState(false); // State for PDF loading indicator

          const currentQuestion = questions.find(q => q.id === currentQuestionId);

          const handleAnswer = (option) => {
            // Store the answer
            setUserAnswers(prevAnswers => ({
              ...prevAnswers,
              [currentQuestion.id]: {
                questionText: currentQuestion.text,
                answerText: option.answerText,
                category: currentQuestion.category,
              }
            }));

            if (option.nextQuestion) {
              setCurrentQuestionId(option.nextQuestion);
            } else if (option.result) {
              setAssessmentResult(option.result);
            }
          };

          const resetAssessment = () => {
            setCurrentQuestionId(1);
            setAssessmentResult(null);
            setShowDisclaimer(true);
            setUserAnswers({});
          };

          // Function to format date for the header
          const getFormattedDate = () => {
            const date = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
          };

          const handleGeneratePdf = async () => {
            setIsGeneratingPdf(true); // Start loading indicator
            const input = document.getElementById('assessment-summary-report'); // ID for the div to capture
            const ctaButtons = input.querySelector('.flex.flex-wrap.justify-center.gap-4.mt-8'); // Select the CTA buttons div

            if (!input) {
              console.error("Summary report element not found for PDF generation.");
              setIsGeneratingPdf(false);
              return;
            }

            // Temporarily hide CTA buttons before capturing
            if (ctaButtons) {
                ctaButtons.style.display = 'none';
            }

            try {
              // Ensure html2canvas and jspdf are available globally
              if (typeof html2canvas === 'undefined' || typeof window.jspdf === 'undefined') {
                console.error("html2canvas or jspdf libraries are not loaded.");
                return;
              }

              const canvas = await html2canvas(input, { scale: 2 }); // Scale for better resolution
              const imgData = canvas.toDataURL('image/png');
              const pdf = new window.jspdf.jsPDF({
                orientation: 'p', // portrait
                unit: 'pt', // points
                format: 'a4' // A4 size
              });

              const imgWidth = 595.28; // A4 width in points
              const imgHeight = canvas.height * imgWidth / canvas.width;

              // Add image to PDF, ensuring it fits on one page.
              // If content is too long, it will be scaled down to fit the page width,
              // but height might exceed if aspect ratio is maintained and content is very tall.
              // Forcing to one page means we don't add new pages.
              pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

              pdf.save('BrandX_Assessment_Guide.pdf');
            } catch (error) {
              console.error("Error generating PDF:", error);
              // In a real app, show a user-friendly error message.
            } finally {
              // Restore CTA buttons display after capturing
              if (ctaButtons) {
                  ctaButtons.style.display = 'flex'; // Or 'block' depending on original display
              }
              setIsGeneratingPdf(false); // End loading indicator
            }
          };

          const handleSendEmail = () => {
            const subject = "Brand X Eligibility Assessment Results";
            let body = "Hello,\n\nPlease find my Brand X Eligibility Assessment results below:\n\n";

            body += "Patient Responses:\n";
            Object.values(userAnswers).forEach(answer => {
              body += `${answer.category}: ${answer.answerText}\n`;
            });
            body += "\n";

            if (assessmentResult) {
              body += "Assessment Recommendation:\n";
              body += `${results[assessmentResult].title}\n`;
              body += `${results[assessmentResult].message}\n`;
              body += `Next Step: ${results[assessmentResult].action}\n\n`;
            }

            body += "Discussion Points for Healthcare Provider:\n";
            body += "- Based on my assessment responses, am I a candidate for Brand X?\n";
            body += "- What additional tests or evaluations might be needed?\n";
            body += "- How does Brand X compare to my current treatment options?\n";
            body += "- What are the potential side effects and contraindications?\n";
            body += "- Is Brand X covered by my insurance plan?\n";
            body += "- What monitoring would be required if I start Brand X?\n\n";

            body += "Disclaimer: This assessment is for informational purposes only and does not constitute medical advice. Only a qualified healthcare provider can determine if Brand X is appropriate for your specific condition.\n\n";
            body += "Generated by Brand X Eligibility Assessment Tool";

            // Encode the body for URL
            const encodedBody = encodeURIComponent(body);

            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodedBody}`;
          };

          if (showDisclaimer) {
            return (
              <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4 font-inter">
                <div className="bg-white p-8 rounded-xl shadow-2xl max-w-lg w-full text-center border-t-4 border-indigo-500">
                  <h2 className="text-3xl font-bold text-indigo-700 mb-6">Disclaimer</h2>
                  <p className="text-gray-700 mb-6 leading-relaxed">
                    This tool is designed to provide general information about potential eligibility for Brand X based on your responses.
                    It is not a substitute for professional medical advice, diagnosis, or treatment.
                    Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition or treatment.
                    Do not disregard professional medical advice or delay in seeking it because of something you have read on this tool.
                  </p>
                  <button
                    onClick={() => setShowDisclaimer(false)}
                    className="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75"
                  >
                    I Understand, Start Assessment
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4 font-inter">
              <div className="bg-white p-8 rounded-xl shadow-2xl max-w-3xl w-full border-t-4 border-indigo-500">
                {assessmentResult ? (
                  // Result Summary View
                  <div id="assessment-summary-report" className="pb-4">
                    <div className="text-center mb-8 border-b-3 border-indigo-700 pb-4">
                      <h1 className="text-4xl font-extrabold text-indigo-800 mb-2">
                        Brand X Eligibility Assessment
                      </h1>
                      <p className="text-lg text-gray-600">Doctor Discussion Guide</p>
                      <p className="text-sm text-gray-500">Assessment Date: {getFormattedDate()}</p>
                    </div>

                    <div className="mb-8">
                      <h2 className="text-2xl font-bold text-indigo-700 mb-4 border-b border-gray-300 pb-2">Patient Responses</h2>
                      {Object.values(userAnswers).map((answer, index) => (
                        <div key={index} className="mb-3">
                          <div className="font-bold text-gray-800">{answer.category}:</div>
                          <div className="ml-5 text-gray-600">{answer.answerText}</div>
                        </div>
                      ))}
                    </div>

                    <div className="mb-8">
                      <h2 className="text-2xl font-bold text-indigo-700 mb-4 border-b border-gray-300 pb-2">Assessment Recommendations</h2>
                      <div className="p-4 my-2 border-l-4 border-indigo-500 bg-blue-50 rounded-md">
                        <p className="text-gray-700">{results[assessmentResult].recommendationHTML}</p>
                      </div>
                    </div>

                    <div className="mb-8">
                      <h2 className="text-2xl font-bold text-indigo-700 mb-4 border-b border-gray-300 pb-2">Discussion Points for Healthcare Provider</h2>
                      <div className="bg-blue-50 p-4 rounded-md shadow-inner">
                        <p className="font-bold text-gray-800 mb-2">Questions to Ask:</p>
                        <ul className="list-disc list-inside text-gray-700">
                          <li>Based on my assessment responses, am I a candidate for Brand X?</li>
                          <li>What additional tests or evaluations might be needed?</li>
                          <li>How does Brand X compare to my current treatment options?</li>
                          <li>What are the potential side effects and contraindications?</li>
                          <li>Is Brand X covered by my insurance plan?</li>
                          <li>What monitoring would be required if I start Brand X?</li>
                        </ul>
                      </div>
                    </div>

                    <div className="text-center text-sm text-gray-500 border-t border-gray-300 pt-4 mt-8">
                      <p className="mb-1"><strong>Disclaimer:</strong> This assessment is for informational purposes only and does not constitute medical advice. Only a qualified healthcare provider can determine if Brand X is appropriate for your specific condition.</p>
                      <p>Generated by Brand X Eligibility Assessment Tool</p>
                    </div>

                    <div className="flex flex-wrap justify-center gap-4 mt-8">
                      <button
                        onClick={handleGeneratePdf}
                        disabled={isGeneratingPdf}
                        className={`bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 ${isGeneratingPdf ? 'opacity-50 cursor-not-allowed' : ''}`}
                      >
                        {isGeneratingPdf ? 'Generating PDF...' : 'Generate PDF Guide'}
                      </button>
                      <button
                        onClick={handleSendEmail}
                        className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75"
                      >
                        Email Results
                      </button>
                      <button
                        onClick={resetAssessment}
                        className="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-75"
                      >
                        Start New Assessment
                      </button>
                    </div>
                  </div>
                ) : (
                  // Question View
                  <div className="text-center">
                    <h1 className="text-4xl font-extrabold text-center text-indigo-800 mb-8">
                      Is <span className="text-blue-600">BRANDX</span> Right For Me?
                    </h1>
                    <p className="text-xl text-gray-800 mb-8 font-medium">{currentQuestion?.text}</p>
                    <div className="space-y-4">
                      {currentQuestion?.options.map((option, index) => (
                        <button
                          key={index}
                          onClick={() => handleAnswer(option)}
                          className="w-full bg-indigo-100 hover:bg-indigo-200 text-indigo-800 font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75"
                        >
                          {option.text}
                        </button>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Mount the React App component to the root div
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
